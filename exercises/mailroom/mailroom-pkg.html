

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>10.6. Mailroom – as a Python Package &mdash; Programming in Python 7.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="11. Advanced Argument Passing" href="../../topics/11-argument_passing/index.html" />
    <link rel="prev" title="10.5. LAB: A Small Example Package" href="../packaging/package_lab.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #4b2e83" >
          

          
            <a href="../../index.html">
          

          
            
            <img src="../../_static/UWPCE_logo_full.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Topics in the Program</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../topics/01-setting_up/index.html">1. Setting up your Environment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/02-basic_python/index.html">2. Basic Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/03-recursion_booleans/index.html">3. Recursion and Booleans</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/04-sequences_iteration/index.html">4. Sequences and Iteration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/05-text_handling/index.html">5. Basic Text Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/06-exceptions/index.html">6. Exception Handling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/07-unit_testing/index.html">7. Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/08-dicts_sets/index.html">8. Dictionaries and Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/09-files/index.html">9. File Handling</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../topics/10-modules_packages/index.html">10. Modules and Packages</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../modules/NamingThings.html">10.1. Style and Naming</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Modules.html">10.2. Code Structure, Modules, and Namespaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Documentation.html">10.3. Documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../modules/Packaging.html">10.4. Packages and Packaging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../packaging/package_lab.html">10.5. LAB: A Small Example Package</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">10.6. Mailroom – as a Python Package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/11-argument_passing/index.html">11. Advanced Argument Passing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/12-comprehensions/index.html">12. Comprehensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/13-intro_oo/index.html">13. Intro to Object Oriented Programing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/14-magic_methods/index.html">14. Properties and Magic Methods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/15-subclassing/index.html">15. Subclassing and Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/16-multiple_inheritance/index.html">16. Multiple Inheritance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/17-functional_programming/index.html">17. Introduction to Functional Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/18-advanced_testing/index.html">18. Advanced Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../topics/99-extras/index.html">19. Extra Topics</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Programming in Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../topics/10-modules_packages/index.html"><span class="section-number">10. </span>Modules and Packages</a> &raquo;</li>
        
      <li><span class="section-number">10.6. </span>Mailroom – as a Python Package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/exercises/mailroom/mailroom-pkg.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      
        <a href="../../topics/11-argument_passing/index.html" class="btn btn-neutral float-right" title="11. Advanced Argument Passing" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../packaging/package_lab.html" class="btn btn-neutral float-left" title="10.5. LAB: A Small Example Package" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mailroom-as-a-python-package">
<span id="exercise-mailroom-package"></span><h1><span class="section-number">10.6. </span>Mailroom – as a Python Package<a class="headerlink" href="#mailroom-as-a-python-package" title="Permalink to this headline">¶</a></h1>
<p>The mailroom program is a small but complete system – if you wanted to make it available for others to test and run, making a “proper” python package is a great idea. Making a package of it will also make it easier to develop and test, even if you are the only one to use it.</p>
<div class="section" id="code-structure">
<h2><span class="section-number">10.6.1. </span>Code Structure<a class="headerlink" href="#code-structure" title="Permalink to this headline">¶</a></h2>
<p>Start with your existing version of mailroom.</p>
<p>It should already be structured with the “logic” code distinct from the user interface (yes, a command line <em>is</em> a user interface). But you may have it all in one file. This isn’t <em>too</em> bad for such a small program, but as a program grows, you really want to keep things separate, in a well organized package.</p>
<p>The first step is to re-structure your code into separate files:</p>
<blockquote>
<div><ul class="simple">
<li><p>one (or more) for the logic code: the code than manipulates the data</p></li>
<li><p>one for the user-interface code: the code with the interactive loops and all the “input” and “print” statements</p></li>
<li><p>one (or more) for tests.</p></li>
</ul>
</div></blockquote>
<p>You should have all this pretty distinct after having refactored for the unit testing. If not, this is a good time to do it!</p>
<p>In addition to those three, you will want to write a top-level script file (probably called <code class="docutils literal notranslate"><span class="pre">mailroom.py</span></code>) that does little but import the ui code and run a <code class="docutils literal notranslate"><span class="pre">main()</span></code> function. It should look something like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python</span>
<span class="kn">from</span> <span class="nn">mailman</span> <span class="kn">import</span> <span class="n">cli</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">cli</span><span class="o">.</span><span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Yes, that’s it! This has the advantage of keeping the top-level script really simple, as it has to get put somewhere else and it can keep the “real” code in the package where it belongs.</p>
</div>
<div class="section" id="making-the-package">
<h2><span class="section-number">10.6.2. </span>Making the Package<a class="headerlink" href="#making-the-package" title="Permalink to this headline">¶</a></h2>
<p>Put all these in a python package structure, something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mailroom</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">py</span>
    <span class="n">mailroom</span>\
        <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
        <span class="n">model</span><span class="o">.</span><span class="n">py</span>
        <span class="n">cli</span><span class="o">.</span><span class="n">py</span>
        <span class="n">tests</span>\
            <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>
            <span class="n">test_model</span><span class="o">.</span><span class="n">py</span>
            <span class="n">test_cli</span><span class="o">.</span><span class="n">py</span>
    <span class="nb">bin</span>
        <span class="n">mailroom</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>You will need to import the logic code from model.py in the cli code in order to use it. You can wait until you learn about mocking to write the code in test_cli.py (so you can leave that out)</p>
<p>Now write your <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> to support your package.</p>
</div>
<div class="section" id="making-the-top-level-script-runnable">
<h2><span class="section-number">10.6.3. </span>Making the top-level script runnable<a class="headerlink" href="#making-the-top-level-script-runnable" title="Permalink to this headline">¶</a></h2>
<p>To get the script installed you have two options. I prefer the more straightforward one, <a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html#the-scripts-keyword-argument">the scripts keyword argument</a></p>
<p>But if you want to get fancy, you can use <code class="docutils literal notranslate"><span class="pre">setuptools</span></code>’s <a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/command-line-scripts.html#the-console-scripts-entry-point">entry points</a></p>
</div>
<div class="section" id="including-data-files">
<h2><span class="section-number">10.6.4. </span>Including data files<a class="headerlink" href="#including-data-files" title="Permalink to this headline">¶</a></h2>
<p>NOTE: If you have a database of donors in a file that you load, then that should go in the package as well. Probably inside the mailroom dir, in a <code class="docutils literal notranslate"><span class="pre">data</span></code> dir or similar. Then you need to add it to your setup.py to make sure it gets copied into the installed package.</p>
<p>There are a few ways to do this:</p>
<p><a class="reference external" href="http://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files">http://setuptools.readthedocs.io/en/latest/setuptools.html#including-data-files</a></p>
<p>I personally like the simplest one with the least magic:</p>
<p><a class="reference external" href="http://python-packaging.readthedocs.io/en/latest/non-code-files.html#adding-non-code-files">include_package_data=True</a></p>
<p>Then you’ll get the data file included in the package in the same place.</p>
<p>Now you’ll need to write your code to find that data file. You can do that by using the __file__ module attribute – then the location of the data file will be relative to the __file__ that your code is in. A little massaging with a <code class="docutils literal notranslate"><span class="pre">pathlib.Path</span></code> should do it.</p>
</div>
<div class="section" id="testing-your-package">
<h2><span class="section-number">10.6.5. </span>Testing your Package<a class="headerlink" href="#testing-your-package" title="Permalink to this headline">¶</a></h2>
<p>When you are done, you should be able to both install your package fully:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install .
</pre></div>
</div>
<p>or in “editable” mode:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pip install -e .
</pre></div>
</div>
<p>When that is done, you should be able to run the top-level script from anywhere:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ mailroom.py
</pre></div>
</div>
<p>and run the test from within the package:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ pytest --pyargs mailroom
</pre></div>
</div>
<p>If you installed in editable mode, then you can update the code and re-run the tests or the script, and it will use the new code right away.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../topics/11-argument_passing/index.html" class="btn btn-neutral float-right" title="11. Advanced Argument Passing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../packaging/package_lab.html" class="btn btn-neutral float-left" title="10.5. LAB: A Small Example Package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, University of Washington, Natasha Aleksandrova, Christopher Barker, Brian Dorsey, Cris Ewing, Christy Heaton, Jon Jacky, Maria McKinley, Andy Miles, Rick Riehle, Joseph Schilz, Joseph Sheedy, Hosung Song. Creative Commons Attribution-ShareAlike 4.0 license

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>